# Homework_Tracing-car-on-ESP32
大一的自动化认识与实践作业，将课上的arduino换成了ESP32，后续可能会使用乐鑫的idf开发。
一开始在学校里将不同的功能写到了不同文件。在实验室里就发生了内存报错（但是当时还看不懂，以为是硬件出错了
内存报错在不同阶段都有出现：
1.仅仅调试编码器时，编码器一转动就报错重启。一开始我以为是esp32的外部中断bug，或者是编码器电平跳变产生了抖动使得在短时间内重复触发外部中断.
在一次偶然中发现将lib中的内容写到Src\main.c中，同时将encoder_val的变量类型由volatile float 改为 int型就能解决内存报错问题。

在这之后，我将其余文件的代码也重新移植到main.c中，虽然我目前还不知道是哪里出了问题，而且这样非常不美观。

2.最初版本的PID代码是复制实验书上的。应该是增量式PID的写法。我将其封装成了一个函数，但是在调用这个函数时同样会产生内存报错。我重新写了一个位置式PID（位置式调参也比较方便），同时取消了封装。并将其中涉及到的变量类型全部改为int型。计算精度下降严重，但是内存报错解决了。明天再改改变量类型吧。

PS：以上两个问题都是LoadProhibited，且所调用的内存是地址非法值（好吧我也不知道到底哪里出了问题）
    关于问题二的细节补充：当我指定PWM的占空比时，电机转速能够稳定在一个比较合理的值，但是每隔一段时间后发生内存报错，esp32重启。而且esp32重启频率和占空比有一定联系，
    当占空比给的越高/低（也就是转速越快时），报错频率更高，电机转得一顿一顿的。（我尝试用过idf和platformio的backtrace。但是芯片版本都定位错了，遂没有深入）
    
接下来的计划：1.修改部分int变量，提高pid计算精度。2.学习platformio下的jlink调试功能 3.思考蓝牙/WiFi功能的添加 4.freertos多线程和多核的使用 5.准备idf的入门

                                                                                                                                        以上写于2023.1.14
